CMAKE_MINIMUM_REQUIRED(VERSION 3.10.2)
PROJECT(airlaps)

OPTION(BUILD_TESTS OFF)
OPTION(ONLY_PYTHON OFF)
OPTION(BUILD_PYTHON_BINDING ON)

ENABLE_LANGUAGE(CXX)
SET(CMAKE_CXX_STANDARD 17)
SET(CMAKE_CXX_STANDARD_REQUIRED ON)
SET(CMAKE_CXX_FLAGS "-fvisibility=hidden -fvisibility-inlines-hidden ${CMAKE_CXX_FLAGS}")

# For multi-threading with C++-17
FIND_PACKAGE(TBB REQUIRED)

# SDK

SET(BACKWARD_VERSION "1.4")
ADD_SUBDIRECTORY(sdk/backward-cpp-${BACKWARD_VERSION})

SET(JSON_VERSION "3.2.0")
SET(JSON_INCLUDE_DIR ${CMAKE_SOURCE_DIR}/sdk/json-${JSON_VERSION}/single_include/nlohmann)
ADD_SUBDIRECTORY(sdk/json-${JSON_VERSION})

SET(PEGTL_VERSION "2.8.0")
SET(PEGTL_BUILD_TESTS OFF CACHE BOOL "disable PEGTL tests")
SET(PEGTL_BUILD_EXAMPLES OFF CACHE BOOL "disable PEGTL examples")
SET(PEGTL_INCLUDE_DIR ${CMAKE_SOURCE_DIR}/sdk/pegtl-${PEGTL_VERSION}/include/tao)
ADD_SUBDIRECTORY(sdk/PEGTL-${PEGTL_VERSION})

SET(SPDLOG_VERSION "1.3.1")
SET(SPDLOG_INCLUDE_DIR ${CMAKE_SOURCE_DIR}/sdk/spdlog-${SPDLOG_VERSION}/include)
ADD_SUBDIRECTORY(sdk/spdlog-${SPDLOG_VERSION})

IF (BUILD_PYTHON_BINDING OR ONLY_PYTHON)
    SET(PYBIND11_VERSION "2.2.4")
    ADD_SUBDIRECTORY(sdk/pybind11-${PYBIND11_VERSION})
ENDIF ()

IF (BUILD_TESTS AND NOT ONLY_PYTHON)
    SET(CATCH2_VERSION "2.4.0")
    SET(CATCH2_INCLUDE_DIR ${CMAKE_SOURCE_DIR}/sdk/Catch2-${CATCH2_VERSION}/single_include/catch2)
    ADD_SUBDIRECTORY(sdk/Catch2-${CATCH2_VERSION})
ENDIF()

# LIB
ADD_SUBDIRECTORY(src)


# TESTS
IF (BUILD_TESTS AND NOT ONLY_PYTHON)
    ENABLE_TESTING()  # leave it outside the 'tests' directory so ctest can find the CTestTestFile.cmake in the top build directory
    ADD_SUBDIRECTORY(tests)
ENDIF()